apiVersion: v1
kind: Pod
metadata:
  name: shared-reader
  namespace: workloads
spec:
  restartPolicy: Always
  securityContext:
    fsGroup: 1000
  initContainers:
    - name: fix-permissions
      image: busybox:1.36
      command: ["sh", "-c", "mkdir -p /data/shared && chown -R 1000:1000 /data/shared && chmod -R 0775 /data/shared"]
      securityContext:
        runAsUser: 0
      volumeMounts:
        - name: shared
          mountPath: /data/shared
  containers:
    - name: reader
      image: busybox:1.36
      command: ["sh", "-c", "sleep 365d"]
      volumeMounts:
        - name: shared
          mountPath: /data/shared
  volumes:
    - name: shared
      persistentVolumeClaim:
        claimName: workloads-shared-pvc
